<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!--
 * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
 * Copyright 2025 Xyna GmbH, Germany
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
-->
<Service xmlns="http://www.gip.com/xyna/xdev/xfractmod" Label="Validate agains OAS Datamodel" TypeName="ValidateAgainsOASDatamodel" TypePath="xfmg.tmf640.validation" Version="1.8">
  <Operation ID="0" IsStatic="false" Label="Validate agains OAS Datamodel" Name="ValidateAgainsOASDatamodel">
    <Input>
      <Data ID="2" Label="Service" ReferenceName="Service" ReferencePath="tmf640.datamodel" VariableName="service2"/>
    </Input>
    <Output/>
    <Throws>
      <Exception Label="OASDatamodelValidationException" ReferenceName="OASDatamodelValidationException" ReferencePath="xfmg.tmf640" VariableName="oASDatamodelValidationException220"/>
    </Throws>
    <ServiceReference ID="35" Label="Array Wrapper" ReferenceName="ArrayWrapper.ArrayWrapper" ReferencePath="xfmg.tmf.util">
      <Source RefID="34"/>
      <Target RefID="34"/>
    </ServiceReference>
    <ServiceReference ID="126" Label="Service" ReferenceName="Service.Service" ReferencePath="tmf640.datamodel">
      <Source RefID="125"/>
      <Target RefID="125"/>
    </ServiceReference>
    <ServiceReference ID="38" Label="Template Management" ReferenceName="TemplateManagement.TemplateManagement" ReferencePath="xact.templates">
      <Source RefID="37"/>
      <Target RefID="37"/>
    </ServiceReference>
    <ServiceReference ID="60" Label="Template Management" ReferenceName="TemplateManagement.TemplateManagement" ReferencePath="xact.templates">
      <Source RefID="59"/>
      <Target RefID="59"/>
    </ServiceReference>
    <Function ID="125" Label="Validate">
      <Source RefID="126"/>
      <Source RefID="2"/>
      <Target RefID="126"/>
      <Target RefID="124"/>
      <Invoke Operation="validate" ServiceID="126">
        <Source RefID="2"/>
      </Invoke>
      <Receive ServiceID="126">
        <Target RefID="124"/>
      </Receive>
    </Function>
    <Choice ID="18" TypeName="BaseChoiceTypeFormula" TypePath="server">
      <Source RefID="124"/>
      <Input>
        <Data ID="25" Label="OAS Validation Result" ReferenceName="OASValidationResult" ReferencePath="xmcp.oas.datatype" VariableName="oASValidationResult25"/>
        <Source RefID="124"/>
      </Input>
      <Case ID="19" Label="true" Premise="%0%.isValid">
        <Assign/>
      </Case>
      <Case ID="20" Label="false">
        <Mappings ID="31" Label="Mapping">
          <Input>
            <Data ID="32" Label="OAS Validation Result" ReferenceName="OASValidationResult" ReferencePath="xmcp.oas.datatype" VariableName="oASValidationResult32"/>
            <Source RefID="124"/>
          </Input>
          <Output>
            <Data ID="33" Label="Array Wrapper" ReferenceName="ArrayWrapper" ReferencePath="xfmg.tmf.util" VariableName="arrayWrapper33"/>
            <Target RefID="15"/>
          </Output>
          <Mapping>%1%.stringArray=%0%.errorMessages</Mapping>
        </Mappings>
        <Function ID="34" Label="as wrapped list">
          <Source RefID="35"/>
          <Source RefID="15"/>
          <Target RefID="35"/>
          <Target RefID="27"/>
          <Invoke Operation="asWrappedList" ServiceID="35">
            <Source RefID="15"/>
          </Invoke>
          <Receive ServiceID="35">
            <Target RefID="27"/>
          </Receive>
        </Function>
        <Function ID="37" Label="Begin document">
          <Source RefID="38"/>
          <Source RefID="39"/>
          <Target RefID="38"/>
          <Target RefID="28"/>
          <Invoke Operation="start" ServiceID="38">
            <Source RefID="39">
              <Meta>
                <LinkType>Constant</LinkType>
              </Meta>
            </Source>
          </Invoke>
          <Receive ServiceID="38">
            <Target RefID="28"/>
          </Receive>
        </Function>
        <Mappings ID="41" Label="">
          <Meta>
            <IsTemplate>true</IsTemplate>
          </Meta>
          <Output>
            <Data ID="43" Label="Document part" ReferenceName="DocumentPart" ReferencePath="xact.templates" VariableName="documentPart43"/>
            <Target RefID="30"/>
          </Output>
          <Mapping>%0%.text=concat("{")</Mapping>
        </Mappings>
        <Foreach ID="44">
          <Source RefID="27"/>
          <InputList RefID="27">
            <Data ID="45" Label="Text" ReferenceName="Text" ReferencePath="base" VariableName="text45"/>
          </InputList>
          <Choice ID="46" TypeName="BaseChoiceTypeFormula" TypePath="server">
            <Source RefID="45"/>
            <Input>
              <Data ID="53" Label="Text" ReferenceName="Text" ReferencePath="base" VariableName="text53"/>
              <Source RefID="45">
                <Meta>
                  <LinkType>UserConnected</LinkType>
                </Meta>
              </Source>
            </Input>
            <Case ID="47" Label="true" Premise="%0%!=null">
              <Mappings ID="55" Label="">
                <Meta>
                  <IsTemplate>true</IsTemplate>
                </Meta>
                <Input>
                  <Data ID="57" Label="Text" ReferenceName="Text" ReferencePath="base" VariableName="text57"/>
                  <Source RefID="45">
                    <Meta>
                      <LinkType>UserConnected</LinkType>
                    </Meta>
                  </Source>
                </Input>
                <Output>
                  <Data ID="58" Label="Document part" ReferenceName="DocumentPart" ReferencePath="xact.templates" VariableName="documentPart58"/>
                  <Target RefID="54"/>
                </Output>
                <Mapping>%1%.text=concat(%0%.text, ", ")</Mapping>
              </Mappings>
              <Assign/>
              <Data ID="54" Label="Document part" ReferenceName="DocumentPart" ReferencePath="xact.templates" VariableName="documentPart54"/>
            </Case>
            <Case ID="48" Label="false">
              <Assign/>
            </Case>
          </Choice>
        </Foreach>
        <Function ID="59" Label="End document">
          <Source RefID="60"/>
          <Source RefID="28"/>
          <Target RefID="60"/>
          <Target RefID="29"/>
          <Invoke Operation="stop" ServiceID="60">
            <Source RefID="28"/>
          </Invoke>
          <Receive ServiceID="60">
            <Target RefID="29"/>
          </Receive>
        </Function>
        <Mappings ID="62" Label="Mapping">
          <Input>
            <Data ID="63" Label="Document" ReferenceName="Document" ReferencePath="xact.templates" VariableName="document63"/>
            <Source RefID="29"/>
          </Input>
          <Output>
            <Exception ID="64" Label="OASDatamodelValidationException" ReferenceName="OASDatamodelValidationException" ReferencePath="xfmg.tmf640" VariableName="oASDatamodelValidationException64"/>
            <Target RefID="17"/>
          </Output>
          <Mapping>%1%.combinedErrorMessage=concat(substring(%0%.text, "0", (length(%0%.text)-"2")), "}")</Mapping>
        </Mappings>
        <Throw ExceptionID="17" ID="65" Label="Throw OAS Datamodel Validation Exception">
          <Meta>
            <PreferedExceptionType>xfmg.tmf640.OASDatamodelValidationException</PreferedExceptionType>
          </Meta>
          <Source RefID="17"/>
        </Throw>
        <Assign/>
        <Data ID="27" IsList="true" Label="Text" ReferenceName="Text" ReferencePath="base" VariableName="text27"/>
        <Data ID="28" Label="Document Context" ReferenceName="DocumentContext" ReferencePath="xact.templates" VariableName="documentContext28"/>
        <Data ID="29" Label="Document" ReferenceName="Document" ReferencePath="xact.templates" VariableName="document29"/>
        <Data ID="30" Label="Document part" ReferenceName="DocumentPart" ReferencePath="xact.templates" VariableName="documentPart30"/>
      </Case>
    </Choice>
    <Data ID="15" Label="Array Wrapper" ReferenceName="ArrayWrapper" ReferencePath="xfmg.tmf.util" VariableName="arrayWrapper15"/>
    <Data ID="39" ReferenceName="PlainText" ReferencePath="xact.templates" VariableName="plainText39"/>
    <Data ID="124" Label="OAS Validation Result" ReferenceName="OASValidationResult" ReferencePath="xmcp.oas.datatype" VariableName="oASValidationResult124"/>
    <Exception ID="17" Label="OASDatamodelValidationException" ReferenceName="OASDatamodelValidationException" ReferencePath="xfmg.tmf640" VariableName="oASDatamodelValidationException17">
      <Target RefID="65"/>
    </Exception>
    <Assign ID="1"/>
  </Operation>
</Service>
